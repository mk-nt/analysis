% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/PrepareMatrix.R
\name{PrepareMatrix}
\alias{PrepareMatrix}
\title{Prepare matrices for phylogenetic analysis}
\usage{
PrepareMatrix(pID, overwrite = FALSE)
}
\arguments{
\item{pID}{Character giving the project identifier, e.g. \code{"1210"} for
\href{https://www.morphobank.org/index.php/Projects/ProjectOverview/project_id/1210}{MorphoBank project 1210}.
Identifiers beginning with \code{"072"} refer to matrices from
\doi{10.1093/sysbio/syab072}, corresponding to files named
\verb{syab<pID>.nex}.}

\item{overwrite}{Logical; whether to overwrite existing processed files.
Defaults to \code{FALSE}.}
}
\value{
\code{PrepareMatrix()} invisibly returns \code{TRUE} if processing succeeds, or
\code{FALSE} if matrix preparation cannot proceed (e.g., due to missing
informative characters).
The function is called primarily for its side-effect of producing
standardized NEXUS matrix files in the appropriate output directory.
}
\description{
\code{PrepareMatrix()} constructs a processed morphological matrix and its
derivatives for downstream phylogenetic analysis.
It reads a raw character matrix and corresponding metadata spreadsheet
from the directory specifed in \code{.config$matrixDir} (default: \verb{/matrices}),
applies standardization rules, re-codes characters according to the
annotation patterns, and outputs curated NEXUS files for use in
subsequent inference.
}
\details{
Each character is categorized as \emph{neomorphic} (presence/absence),
\emph{transformational} (multi-state), or \emph{ignored} according to the pattern
specified in the metadata file.
Inapplicable tokens in neomorphic characters are converted to absences
(0) following \insertCite{Brazeau2011}{neotrans}.
Characters may also be translated according to custom mapping patterns
defined in the spreadsheet.

The function creates four main output files at the path specified by
\code{MatrixFile(pID)}:
\describe{
\item{\verb{*.nex}}{Full processed matrix.}
\item{\verb{*-neo.nex}}{Subset containing informative neomorphic characters.}
\item{\verb{*-trans.nex}}{Subset containing informative transformational characters.}
\item{\verb{*-neo-rand.nex}, \verb{*-trans-rand.nex}}{Matched random subsets for
comparative analysis.}
}

The function expects metadata spreadsheets formatted according to the
\link[=matrix-processing]{matrix-processing vignette}, containing at least
the columns \code{"Character Pattern"} and \code{"Unseen States"}.
Character patterns define how tokens are grouped and interpreted;
invalid or mismatched patterns will trigger diagnostic errors.
Parsimony-uninformative characters (which define no non-trivial bipartitions)
are excluded from subset matrices.

The function automatically sanitizes taxon names for NEXUS compatibility
and ensures that neomorphic characters are strictly binary (\code{0}, \code{1}).
Multi-state characters are re-encoded so that their state tokens form a
contiguous sequence starting from zero.
}
\references{
\insertAllCited{}
}
