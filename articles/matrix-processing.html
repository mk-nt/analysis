<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Annotate matrices • neotrans</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Annotate matrices">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">neotrans</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2025-11-06</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/compare-trees.html">Impact of model choice on tree topologies</a>
    </li>
    <li>
      <a href="../articles/install.html">Install the neotrans package</a>
    </li>
    <li>
      <a href="../articles/matrix-processing.html">Annotate matrices</a>
    </li>
    <li>
      <a href="../articles/model-cost.html">Compuational cost of models</a>
    </li>
    <li>
      <a href="../articles/model-pairs.html">Comparison of model pairs</a>
    </li>
    <li>
      <a href="../articles/parameter-analysis.html">Parameter analysis</a>
    </li>
    <li>
      <a href="../articles/parameter-values.html">Parameter value summary</a>
    </li>
    <li>
      <a href="../articles/predictions.html">Predicting parameters and fit</a>
    </li>
    <li>
      <a href="../articles/prior-posterior.html">Prior-posterior comparison</a>
    </li>
    <li>
      <a href="../articles/stationarity.html">Evaluating stationarity</a>
    </li>
    <li>
      <a href="../articles/wct-comparison.html">Comparison to well-corroborated trees</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ms609/neotrans/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Annotate matrices</h1>
                        <h4 data-toc-skip class="author">Martin R. Smith
<a href="mailto:martin.smith@durham.ac.uk" class="email">martin.smith@durham.ac.uk</a>
</h4>
            
            <h4 data-toc-skip class="date">2025-11-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ms609/neotrans/blob/main/vignettes/matrix-processing.Rmd" class="external-link"><code>vignettes/matrix-processing.Rmd</code></a></small>
      <div class="hidden name"><code>matrix-processing.Rmd</code></div>

    </div>

    
    
<p>This project draws on a subset of annotated matrices obtained from
MorphoBank.</p>
<div class="section level3">
<h3 id="creating-a-local-copy-of-the-existing-repository">Creating a local copy of the existing repository<a class="anchor" aria-label="anchor" href="#creating-a-local-copy-of-the-existing-repository"></a>
</h3>
<p>If you have already <a href="install.html">installed the neotrans
package</a>, then your <code>neotrans</code> folder will contain a
directory called <code>matrices</code>.</p>
<p>The matrices directory is a git ‘submodule’, which is to say, it is
linked to a standalone repository <a href="http://github.com/neo-trans/matrices" class="external-link">neo-trans/matrices</a>.</p>
<p>You will want to replace this default directory with one of our own.
A good way to do this is to create a GitHub account and use the “Fork”
option at <a href="http://github.com/neo-trans/matrices" class="external-link">neo-trans/matrices</a> to
create a linked copy of this repository, which will be associated with
your own account.</p>
<p>This linked repository can then be edited on a local computer by
downloading <a href="https://desktop.github.com/download/" class="external-link">GitHub
Desktop</a> and using the “File→Clone Repository” option. Clone the
repository into <code>path/to/neotrans/</code> such that you create a
new <code>matrices</code> directory in that folder, having deleted the
directory that was there already.</p>
<p>(If you have already cloned the <code>matrices</code> directory
elsewhere on your computer, then you can move that directory and update
GitHub desktop to point to its new location within the
<code>neotrans</code> directory.)</p>
</div>
<div class="section level3">
<h3 id="editing-your-own-copy-of-the-repository">Editing your own copy of the repository<a class="anchor" aria-label="anchor" href="#editing-your-own-copy-of-the-repository"></a>
</h3>
<p>To view the local version of your repository, use GitHub Desktop’s
“Repository” menu to “Show in Explorer”. Any changes to these local
files will be tracked in GitHub Desktop.</p>
<p>Modifications to files can be selected and “committed” to be locally
recorded. Once changes have been committed, the “Push origin” option
will update the forked copy of the repository on the GitHub server with
your committed changes.</p>
</div>
<div class="section level3">
<h3 id="what-is-in-the-matrices-repository">What is in the <code>matrices</code> repository<a class="anchor" aria-label="anchor" href="#what-is-in-the-matrices-repository"></a>
</h3>
<p>The directory contains Nexus files corresponding to morphological
matrices, named e.g. <code>project1210.nex</code>.</p>
<p>You can find the corresponding project on MorphoBank to inspect the
original character state information, e.g. <a href="https://www.morphobank.org/index.php/Projects/ProjectOverview/project_id/1210" class="external-link uri">https://www.morphobank.org/index.php/Projects/ProjectOverview/project_id/1210</a></p>
<p>For a subset of these matrices there is a corresponding Excel
spreadsheet named, for example,
<code>Project1210_D. A. Janies(2011).xlsx</code>. (Note that the file
names are used to link the matrices to the spreadsheets and should begin
<code>project####</code>.)</p>
<p>You can see the format required of the Excel spreadsheets that
annotate the character types by looking at those already in the
repository. You should be able to copy and paste the ‘charlabels’ column
directly from the nexus file (which you can open with a text editor such
as e.g. Notepad++).</p>
<p>The important thing is that the file has three columns with the names
“Charlabels”, “Character Pattern”, and “Unseen States” (case sensitive);
this will allow the files to be processed by R later on.</p>
<p>A subset of characters may require reformulating, per <span class="citation">Brazeau (2011)</span>. The method for reformulating a
character can be thought of as encoding a table. For example:</p>
<blockquote>
<p>Old character: Tail. States: <code>0</code>, absent; <code>1</code>,
present, red; <code>2</code>, present, blue</p>
</blockquote>
<p>Preferred formulation <span class="citation">(per Brazeau, 2011;
Brazeau, Guillerme, &amp; Smith, 2019)</span>:</p>
<blockquote>
<p>New character 1: Tail presence (Neomorphic): <code>0</code>, absent;
<code>1</code> present</p>
<p>New character 2: Tail colour (Transformational, unknown number of
possible states): <code>1</code>, red; <code>2</code>, blue</p>
</blockquote>
<p>The following table records how each state in the old character can
be translated into equivalent states into the two characters in our
preferred reformulation.</p>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Old character</th>
<th>New character 1</th>
<th>New character 2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td></td>
<td>Neomorphic = <strong>N</strong>
</td>
<td>Transformational = <strong>T</strong> <br> Unknown number of states
= <strong>?</strong>
</td>
</tr>
<tr class="even">
<td>Token <code>0</code> =</td>
<td><code>0</code></td>
<td><code>-</code></td>
</tr>
<tr class="odd">
<td>Token <code>1</code> =</td>
<td><code>1</code></td>
<td><code>1</code></td>
</tr>
<tr class="even">
<td>Token <code>2</code> =</td>
<td><code>1</code></td>
<td><code>2</code></td>
</tr>
</tbody>
</table>
<p>We encode this table, using a semicolon <code>;</code> to separate
the rows, producing:</p>
<p><code>NT?;0=0-;1=11;2=12</code></p>
<p>This coding is then recorded in the “Character Pattern” column in the
Excel spreadsheet. This will allow us to replace the original character
with its ‘corrected’ replacements.</p>
<p>We can use the same method to relabel the states of a character. For
example, <code>N;0=1;1=0</code> would relabel</p>
<blockquote>
<p>Trait: <code>0</code>, present; <code>1</code>, absent</p>
</blockquote>
<p>such that <code>0</code> denotes the absent state.</p>
</div>
<div class="section level3">
<h3 id="creating-relabelled-matrices">Creating relabelled matrices<a class="anchor" aria-label="anchor" href="#creating-relabelled-matrices"></a>
</h3>
<p>Once the annotation spreadsheet is complete, the next step is to
create clean versions of the matrices in which the characters have been
relabelled according to our desired formulations.</p>
<p>To do this you’ll need to <a href="install.html">install the neotrans
package</a>.</p>
<p>Then you can run <code>PrepareMatrix("1210")</code> to create new
matrix files in the <code>projects</code> subfolder of your
<code>neotrans</code> directory. The key output is:</p>
<ul>
<li>
<code>projects/project1210.nex</code>: a relabelled dataset, in
Nexus format;</li>
<li>
<code>projects/project1210.neo.nex</code>: The relabelled neomorphic
characters;</li>
<li>
<code>projects/project1210.trans.nex</code>: The relabelled
transformational characters.</li>
</ul>
<p>Typing <code>?PrepareMatrix()</code> in the console will launch the
help page with complete information about this function and its
output.</p>
</div>
<div class="section level3">
<h3 id="working-locally-with-relabelled-matrices">Working locally with relabelled matrices<a class="anchor" aria-label="anchor" href="#working-locally-with-relabelled-matrices"></a>
</h3>
<p>It is simplest to launch the “neotrans” R project in <a href="https://posit.co/download/rstudio-desktop/" class="external-link">RStudio</a>, via the
file <code>neotrans.Rproj</code> in the neotrans directory</p>
<p>Otherwise, your working directory (<code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code>) may not
correspond to the <code>neotrans</code> project root, and you will need
to amend <code>R/FilePaths.R</code> and re-build the package
accordingly.</p>
<p>Once you’ve done this, you can conduct simple analyses using R
scripts. For example, to conduct equal weights parsimony on just the
neomorphic characters you just created, you can run</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ms609.github.io/TreeSearch/" class="external-link">"TreeSearch"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load data</span></span>
<span><span class="va">neo1210file</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MatrixFile.html">MatrixFile</a></span><span class="op">(</span><span class="st">"1210"</span>, <span class="st">"neo.nex"</span><span class="op">)</span></span>
<span><span class="va">neo1210</span> <span class="op">&lt;-</span> <span class="fu">TreeTools</span><span class="fu">::</span><span class="fu"><a href="https://ms609.github.io/TreeTools/reference/ReadCharacters.html" class="external-link">ReadAsPhyDat</a></span><span class="op">(</span><span class="va">neo1210file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Conduct (quick) tree search</span></span>
<span><span class="va">neo1210Trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ms609.github.io/TreeSearch/reference/MaximizeParsimony.html" class="external-link">MaximizeParsimony</a></span><span class="op">(</span><span class="va">neo1210</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View first tree</span></span>
<span><span class="va">tree1</span> <span class="op">&lt;-</span> <span class="va">neo1210Trees</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">oPar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">4</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="co"># Set up plotting area</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oPar</span><span class="op">)</span> <span class="co"># Restore plotting defaults</span></span>
<span></span>
<span><span class="co"># Calculate extra length of each character on the tree</span></span>
<span><span class="fu"><a href="https://ms609.github.io/TreeSearch/reference/CharacterLength.html" class="external-link">CharacterLength</a></span><span class="op">(</span><span class="va">tree1</span>, <span class="va">neo1210</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://ms609.github.io/TreeSearch/reference/MinimumLength.html" class="external-link">MinimumLength</a></span><span class="op">(</span><span class="va">neo1210</span><span class="op">)</span></span></code></pre></div>
<p>You may wish to read <code><a href="https://ms609.github.io/TreeSearch/reference/MaximizeParsimony.html" class="external-link">?MaximizeParsimony</a></code> and the
accompanying <a href="https://ms609.github.io/TreeSearch/articles/tree-search.html#command-line-tree-search" class="external-link">vignette</a>
for more complete and reliable results.</p>
</div>
<div class="section level3">
<h3 id="working-remotely-with-matrices">Working remotely with matrices<a class="anchor" aria-label="anchor" href="#working-remotely-with-matrices"></a>
</h3>
<p>It may be convenient to run more sophisticated or time-consuming
analyses on a remote computing cluster.</p>
<p>RevBayes scripts that are added to <code>rbScripts</code> can be
executed remotely for inference or for marginal likelihood estimation
using the <code><a href="../reference/EnqueueML.html">EnqueueML()</a></code> and <code><a href="../reference/EnqueueMC.html">EnqueueMC()</a></code>
functions; see their help pages for setup documentation.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-Brazeau2011" class="csl-entry">
Brazeau, M. D. (2011). Problematic character coding methods in
morphology and their effects. <em>Biological Journal of the Linnean
Society</em>, <em>104</em>(3), 489–498. doi: <a href="https://doi.org/10.1111/j.1095-8312.2011.01755.x" class="external-link">10.1111/j.1095-8312.2011.01755.x</a>
</div>
<div id="ref-Brazeau2019" class="csl-entry">
Brazeau, M. D., Guillerme, T., &amp; Smith, M. R. (2019). <span class="nocase">An algorithm for morphological phylogenetic analysis with
inapplicable data</span>. <em>Systematic Biology</em>, <em>68</em>,
619–631. doi: <a href="https://doi.org/10.1093/sysbio/syy083" class="external-link">10.1093/sysbio/syy083</a>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Martin R. Smith.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
